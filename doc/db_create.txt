CREATE SEQUENCE USERS_SEQ INCREMENT BY 1;
CREATE SEQUENCE CAPITALS_SEQ INCREMENT BY 1;
CREATE SEQUENCE COUNTRIES_SEQ INCREMENT BY 1;
CREATE SEQUENCE NEIGHBOURS_SEQ INCREMENT BY 1;

CREATE TABLE USERS (
  ID INT NOT NULL DEFAULT nextval('USERS_SEQ') PRIMARY KEY,
  USERNAME VARCHAR(50) NOT NULL UNIQUE,
  PASSWORD VARCHAR(50) NOT NULL,
  ENABLED  BOOLEAN     NOT NULL,
  ROLE     VARCHAR(20) NOT NULL
);

CREATE TABLE CAPITALS (
  ID INT NOT NULL DEFAULT nextval('CAPITALS_SEQ') PRIMARY KEY,
  NAME       VARCHAR(50) NOT NULL UNIQUE,
  POPULATION INT
);

CREATE TABLE COUNTRIES (
  ID INT NOT NULL DEFAULT nextval('COUNTRIES_SEQ') PRIMARY KEY,
  NAME       VARCHAR(50) NOT NULL UNIQUE,
  CAPITAL    INT,
  AREA       INT,
  POPULATION INT,
  CURRENCY   VARCHAR(3),
  FOREIGN KEY (CAPITAL) REFERENCES CAPITALS(ID)
);

CREATE TABLE NEIGHBOURS (
  ID INT NOT NULL DEFAULT nextval('NEIGHBOURS_SEQ') PRIMARY KEY,
  COUNTRY    INT NOT NULL,
  NEIGHBOUR  INT NOT NULL,
  FOREIGN KEY (COUNTRY) REFERENCES COUNTRIES(ID),
  FOREIGN KEY (NEIGHBOUR) REFERENCES COUNTRIES(ID)
);

-- VIEWS
CREATE VIEW POPULATION_DENSITY AS
SELECT ct.name country, ct.population / ct.area population_density
FROM countries ct JOIN capitals cp ON ct.capital = cp.id
order by population_density desc;

CREATE VIEW COUNTRIES_WITHOUT_NEIGHBOURS AS
SELECT c.name countries_wo_neighbour
FROM countries c WHERE c.id NOT IN (SELECT country FROM neighbours);

CREATE VIEW COUNTRIES_AND_CAPS AS
SELECT ct.name countries, cp.name capitals
FROM countries ct JOIN capitals cp ON ct.capital = cp.id;